<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Proof of Build</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="Proof of Build is a Base-native collectible for early miniapp creators and supporters. Mint your onchain builder badge.">

  <!-- OG & Miniapp -->
  <meta property="og:title" content="Proof of Build" />
  <meta property="og:description" content="Base-native collectible for builders." />
  <meta property="og:image" content="https://pob-lyart.vercel.app/og.png" />
  <meta name="fc:miniapp"
    content='{"version":"1","imageUrl":"https://pob-lyart.vercel.app/og.png","button":{"title":"Mint POB","action":{"type":"launch_miniapp","name":"Proof of Build","url":"https://pob-lyart.vercel.app","splashImageUrl":"https://pob-lyart.vercel.app/icon.png","splashBackgroundColor":"#0d1117"}}}' />

  <link rel="icon" href="icon.png">
  <style>
    body {
      margin:0;background:#0b0f13;color:#e6edf3;font-family:Inter,system-ui,sans-serif;
      display:flex;justify-content:center;align-items:center;min-height:100vh
    }
    .wrap {width:90%;max-width:420px;background:#0f141a;border:1px solid #222;border-radius:14px;padding:22px;text-align:center}
    img {width:100%;border-radius:12px;box-shadow:0 0 40px rgba(0,255,255,.05)}
    h1 {margin:14px 0;font-size:24px}
    .muted {color:#8ea0ae;font-size:14px}
    input,button {width:100%;height:48px;border-radius:12px;border:none;font-size:16px}
    input {padding:0 12px;background:#12191f;color:#e6edf3;border:1px solid #222;margin-top:14px}
    .btn-primary {background:linear-gradient(180deg,#53e6ff,#1fbfd9);color:#001319;font-weight:700;margin-top:12px;cursor:pointer}
    .btn-outline {margin-top:10px;background:none;border:1px solid #2a3a44;color:#d8e3eb;cursor:pointer}
    .addr {display:block;margin-top:8px;font-size:13px;color:#9db1bb}
  </style>
</head>
<body>
  <div class="wrap">
    <img src="og.png" alt="POB">
    <h1>Proof of Build</h1>
    <p class="muted">Mint your onchain builder badge and join early Base miniapp creators.</p>

    <input id="qty" type="number" min="1" value="1" />
    <button id="mintBtn" class="btn-primary">Mint POB</button>
    <button id="connectBtn" class="btn-outline">Connect Wallet</button>
    <span id="acct" class="addr">Wallet: not connected</span>
  </div>

  <script src="https://unpkg.com/viem@2.21.32/dist/index.umd.js"></script>
  <script>
    const CONTRACT = '0x01b91784C9B80d7fEfb206E2E1FC63ef1616386C';
    const TOKEN_ID = 0n;
    const PRICE_ETH = '0.0001';
    const NATIVE = '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE';

    const { createPublicClient, createWalletClient, http, parseEther, custom, getContract, chain } = viem;
    const base = chain.base;
    const publicClient = createPublicClient({ chain: base, transport: http() });

    let walletClient, account;
    const mintBtn = document.getElementById('mintBtn');
    const connectBtn = document.getElementById('connectBtn');
    const acctEl = document.getElementById('acct');
    const qtyEl = document.getElementById('qty');

    const abi = [/* paste full ABI JSON di sini */];

    const contract = getContract({
      address: CONTRACT,
      abi,
      client: { public: publicClient },
    });

    async function ensureBase() {
      if (!window.ethereum) throw new Error('Wallet not found');
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: viem.toHex(base.id) }],
        });
      } catch (e) {
        if (e.code === 4902) {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: viem.toHex(base.id),
              chainName: 'Base',
              rpcUrls: ['https://mainnet.base.org'],
              nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
              blockExplorerUrls: ['https://basescan.org'],
            }],
          });
        } else throw e;
      }
    }

    async function connectWallet() {
      const provider = window.ethereum;
      if (!provider) return alert('Please install a wallet.');
      await ensureBase();

      walletClient = createWalletClient({
        chain: base,
        transport: custom(provider),
      });
      await provider.request({ method: 'eth_requestAccounts' });

      const [addr] = await walletClient.requestAddresses();
      account = addr;
      acctEl.textContent = 'Wallet: ' + addr.slice(0,6) + '…' + addr.slice(-4);
      connectBtn.textContent = 'Wallet connected';
    }

    async function mint() {
      try {
        if (!walletClient) await connectWallet();
        const qty = BigInt(qtyEl.value || 1);
        const priceWei = parseEther(PRICE_ETH);

        const hash = await walletClient.writeContract({
          address: CONTRACT,
          abi,
          functionName: 'claim',
          args: [
            account,
            TOKEN_ID,
            qty,
            NATIVE,
            priceWei,
            { proof: [], quantityLimitPerWallet: 0n, pricePerToken: priceWei, currency: NATIVE },
            '0x'
          ],
          value: priceWei * qty,
          account,
        });

        await publicClient.waitForTransactionReceipt({ hash });
        alert('✅ Mint success!');
      } catch (err) {
        let msg = err?.shortMessage || err?.message || String(err);
        if (msg.includes('DropClaimInvalidTokenPrice'))
          msg = 'Mint gagal: pastikan price = 0.0001 ETH dan currency = ETH di dashboard.';
        alert(msg);
      }
    }

    connectBtn.onclick = connectWallet;
    mintBtn.onclick = mint;
  </script>
</body>
</html>
